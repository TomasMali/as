"use strict";(globalThis["webpackChunkweb_as400"]=globalThis["webpackChunkweb_as400"]||[]).push([[318],{318:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Q});a(5663);var l=a(3673),r=a(1959),o=a(8880),i=a(2323),n=a(1907),c=a(589);const s=(0,n.Q_)("ticket",{state:()=>({tickets:[],grid:!1,send:!1,loading:!1,loadingTable:!1,loadingInputFiles:!1,loadingCat:!1,filter:"",resolved:!0,ticSearch:(0,r.iH)(null),ticSearchUrl:"",columns:[{name:"similarity_percentage",label:"Similarity (%)",field:"similarity_percentage",sortable:!0,align:"left",format:e=>e.toFixed(4)},{name:"ticket",label:"Ticket",field:"ticket",sortable:!0,align:"center",format:e=>`<a href="${e}" target="_blank">${e}</a>`},{name:"solution",label:"Soluzione",field:"solution",sortable:!0,align:"left"}]}),getters:{getTics:e=>e.tickets},actions:{async loadTicket(e){let t="http://10.100.0.30:5005/?ticket="+e;const a=await fetch(t,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",enctype:"mutipart/form-data"});console.log(t);const l=await a.json();if(this.sendLogsAction(e),!a.ok)throw 409===l.code?new Error(l.message):new Error("Request failed with error code: "+a.status);this.tickets=l},async sendLogsAction(e){let t="http://"+window.location.hostname+":3300/db2/log/?log="+c.Z.getItem("currentUser")+" TICKET: ---\x3e      \n\n"+e;console.log(t);const a=await fetch(t,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",enctype:"mutipart/form-data"}),l=await a.json();if(!a.ok)throw 409===l.code?new Error(l.message):new Error("Request failed with error code: "+a.status)}}});var d=a(2841),m=a(8825);const u={class:"row q-pa-md"},p={key:0,class:"q-ml-xl q-mt-md"},g=["href"],h={style:{"margin-top":"12px"}},f=["innerHTML"],w={computed:{generateLinkHtml:function(){return function(e){return`<a   href="${e}" target="_blank">${e}</a>`}}}},b=Object.assign(w,{__name:"Ticket",setup(e){const t=s(),a=(0,r.iH)(null);(0,m.Z)();function n(){if(t.ticSearch.endsWith(","))return!1;var e=t.ticSearch.replace(",","").trim();return"string"==typeof e&&(!isNaN(e)&&!isNaN(parseFloat(e)))}const c=(e,t)=>{let a=void 0!==t?t(e):e;return a=void 0===a||null===a?"":String(a),a=a.split('"').join('""'),`"${a}"`},w=()=>{var e=[];a.value.filteredSortedRows.length>0&&(e=Object.getOwnPropertyNames(a.value.filteredSortedRows[0]));var t=[];e.forEach((e=>{t.push({field:e,name:e,label:e})}));const l=[t.map((e=>c(e.label)))].concat(a.value.filteredSortedRows.map((e=>t.map((t=>c("function"===typeof t.field?t.field(e):e[void 0===t.field?t.name:t.field],t.format))).join(",")))).join("\r\n");(0,d.Z)("table-export.csv",l,"text/csv")},b=async()=>{n()&&(t.ticSearchUrl="https://tsnew.sanmarcoweb.com/it/ticket/index/index/operation/view/id/"+t.ticSearch,t.send=!0,t.loading=!0,await t.loadTicket(t.ticSearch),t.tickets.value=t.getTics,t.loading=!1)},S=()=>{null!=t.ticSearch&&""!=t.ticSearch?b():console.log("Not a valid word")};return(0,l.bv)((()=>{})),(e,c)=>{const s=(0,l.up)("q-icon"),d=(0,l.up)("q-input"),m=(0,l.up)("q-btn"),b=(0,l.up)("q-card-section"),k=(0,l.up)("q-card"),y=(0,l.up)("q-toggle"),U=(0,l.up)("q-inner-loading"),v=(0,l.up)("q-table");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l.Wm)(k,{bordered:"",class:"q-my-sm q-mx-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{class:""},{default:(0,l.w5)((()=>[(0,l._)("div",u,[(0,l.Wm)(d,{class:"q-mr-sm",square:"",color:"primary","label-color":"primary",outlined:"",clearable:"",modelValue:(0,r.SU)(t).ticSearch,"onUpdate:modelValue":c[0]||(c[0]=e=>(0,r.SU)(t).ticSearch=e),label:"Search Ticket",onKeyup:(0,o.D2)(S,["enter"])},{append:(0,l.w5)((()=>[(0,l.Wm)(s,{name:"bolt",color:"primary"})])),_:1},8,["modelValue","onKeyup"]),(0,l.Wm)(m,{dense:"",inline:"",color:"primary q-ml-sm",label:"Search","icon-right":"send",onClick:S,disable:null==(0,r.SU)(t).ticSearch||""==(0,r.SU)(t).ticSearch||!n()},null,8,["disable"]),(0,r.SU)(t).send?((0,l.wg)(),(0,l.iD)("p",p,[(0,l.Uk)(" Ticket originale: "),(0,l._)("a",{href:(0,r.SU)(t).ticSearchUrl,target:"_blank"},(0,i.zw)((0,r.SU)(t).ticSearchUrl),9,g)])):(0,l.kq)("",!0)])])),_:1})])),_:1}),(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(v,{class:"text-subtitle2 my-sticky-header-table","table-header-class":"text-white ",rows:(0,r.SU)(t).getTics,columns:(0,r.SU)(t).columns,"row-key":"ticStore.getTics.ticket","auto-width":"",grid:(0,r.SU)(t).grid,loading:(0,r.SU)(t).loading,boarderd:"",title:"Risultato Ticket",separator:"cell",style:{height:"720px"},filter:(0,r.SU)(t).filter,rowsPerPage:1e4,"rows-per-page-options":[0,8,18],ref_key:"tabCol",ref:a},{"top-right":(0,l.w5)((()=>[(0,l.Wm)(d,{borderless:"",dense:"",debounce:"300",modelValue:(0,r.SU)(t).filter,"onUpdate:modelValue":c[2]||(c[2]=e=>(0,r.SU)(t).filter=e),placeholder:"Search"},{append:(0,l.w5)((()=>[(0,l.Wm)(s,{name:"search",color:"white"}),(0,l.Wm)(y,{modelValue:(0,r.SU)(t).grid,"onUpdate:modelValue":c[1]||(c[1]=e=>(0,r.SU)(t).grid=e),color:"red",label:"Grid"},null,8,["modelValue"])])),_:1},8,["modelValue"]),(0,l.Wm)(m,{flat:"",class:"q-ml-xl",color:"yellow","icon-right":"archive",label:"Export to csv","no-caps":"",onClick:w})])),loading:(0,l.w5)((()=>[(0,l.Wm)(U,{showing:"",color:"primary"})])),"body-cell-ticket":(0,l.w5)((t=>[(0,l._)("div",h,[(0,l._)("span",{innerHTML:e.generateLinkHtml(t.row[t.col.field])},null,8,f)])])),_:1},8,["rows","columns","grid","loading","filter"])])),_:1})])),_:1})])}}});var S=a(151),k=a(5589),y=a(4842),U=a(4554),v=a(8240),T=a(6429),_=a(8886),q=a(6941),x=a(6115),W=a(7518),Z=a.n(W);const C=b,Q=C;Z()(b,"components",{QCard:S.Z,QCardSection:k.Z,QInput:y.Z,QIcon:U.Z,QBtn:v.Z,QTable:T.Z,QToggle:_.Z,QInnerLoading:q.Z,QField:x.Z})}}]);